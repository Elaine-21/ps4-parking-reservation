<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Parking Map</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    .slots-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); 
      gap: 15px; 
    }
    .slot { 
      padding: 15px; 
      border-radius: 8px; 
      text-align: center; 
      border: 1px solid #ddd; 
      display: flex; 
      flex-direction: column; 
      justify-content: center;
      min-height: 120px;
    }

    .slot-number {
      font-size: 2em;
      font-weight: 800;
      display: block;
      margin-bottom: 5px;
    }

    /* STATUS COLORS */
    /* Available = Green */
    .slot.available { background: #dcfce7; border-color: #86efac; color: #14532d; }
    /* Occupied/Reserved = Red */
    .slot.occupied, .slot.reserved { 
      background: #fee2e2; 
      border-color: #fca5a5; 
      color: #7f1d1d; 
    }
    
    /* Maintenance = Grey */
    .slot.maintenance { background: #f3f4f6; color: #6b7280; border-color: #d1d5db; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h2>Parking Map</h2>
        <a href="/dashboard">‚Üê Back</a>
      </header>

      <% if (!parkingSlots || parkingSlots.length === 0) { %>
        <p>No parking slots found.</p>
      <% } else { %>
        <% Object.keys(groupedByFloor).sort((a,b) => Number(a) - Number(b)).forEach(function(floorKey) { %>
          <div style="margin-bottom: 30px;">
            <h3 style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 15px;">Floor <%= floorKey %></h3>
            <div class="slots-grid">
              <% groupedByFloor[floorKey].forEach(function(slot) { 
                 const status = (slot.status || '').toLowerCase(); 
                 // Ensure we have a label even if DB is empty
                 const label = slot.slot_number || slot.number || ('Slot ' + slot.id);
              %>
                <div class="slot <%= status %>">
                  <span class="slot-number"><%= label %></span>
                  
                  <span style="font-size: 0.85em; font-weight: 600;"><%= slot.type %></span>
                  <span style="font-size: 0.75em; text-transform: uppercase;"><%= status %></span>

                  <% if (status === 'available') { %>
                    <form method="GET" action="/reserve-parking" style="margin-top: 10px;">
                      <input type="hidden" name="slotId" value="<%= slot.id %>">
                      <button type="submit" class="btn btn-primary" style="width:100%; padding: 5px; font-size: 0.8em; margin:0;">Reserve</button>
                    </form>
                  <% } %>
                </div>
              <% }); %>
            </div>
          </div>
        <% }); %>
      <% } %>
    </div>
  </div>
</body>
</html>